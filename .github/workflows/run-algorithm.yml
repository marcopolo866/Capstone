name: Run Algorithm
run-name: Run Algorithm (${{ github.event.inputs.request_id || github.event.client_payload.request_id || github.run_id }})

on:
  workflow_dispatch:
    inputs:
      algorithm:
        description: 'Algorithm to run'
        required: true
        type: choice
        options:
          - dijkstra
          - glasgow
          - vf3
          - subgraph
      iterations:
        description: 'Number of benchmark iterations'
        required: false
        type: string
        default: '1'
      warmup:
        description: 'Number of warmup runs (per test)'
        required: false
        type: string
        default: '1'
      input_mode:
        description: 'Input mode (premade or generate)'
        required: false
        type: choice
        options:
          - premade
          - generate
        default: generate
      n:
        description: 'Generated graph node count (N)'
        required: false
        type: string
        default: '100'
      k:
        description: 'Generated pattern node count (k)'
        required: false
        type: string
        default: '10'
      density:
        description: 'Generated graph density (0-1)'
        required: false
        type: string
        default: '0.01'
      seed:
        description: 'Generator seed (optional)'
        required: false
        type: string
      input_files:
        description: 'Comma-separated input file paths'
        required: false
        type: string
        default: ''
      request_id:
        description: 'Client request identifier'
        required: false
        type: string
  repository_dispatch:
    types:
      - run-algorithm

jobs:
  run-algorithm:
    runs-on: ubuntu-latest
    env:
      ALGORITHM_INPUT: ${{ github.event.inputs.algorithm || github.event.client_payload.algorithm }}
      ITERATIONS_INPUT: ${{ github.event.inputs.iterations || github.event.client_payload.iterations }}
      WARMUP_INPUT: ${{ github.event.inputs.warmup || github.event.client_payload.warmup }}
      INPUT_MODE_INPUT: ${{ github.event.inputs.input_mode || github.event.client_payload.input_mode }}
      GENERATOR_N_INPUT: ${{ github.event.inputs.n || github.event.client_payload.n }}
      GENERATOR_K_INPUT: ${{ github.event.inputs.k || github.event.client_payload.k }}
      GENERATOR_DENSITY_INPUT: ${{ github.event.inputs.density || github.event.client_payload.density }}
      GENERATOR_SEED_INPUT: ${{ github.event.inputs.seed || github.event.client_payload.seed }}
      INPUT_FILES_INPUT: ${{ github.event.inputs.input_files || github.event.client_payload.input_files }}
      REQUEST_ID_INPUT: ${{ github.event.inputs.request_id || github.event.client_payload.request_id }}

    permissions:
      contents: write
      actions: read
      checks: write

    steps:
      - name: Checkout repository (shallow)
        id: checkout_shallow
        uses: actions/checkout@v4
        continue-on-error: true
        with:
          fetch-depth: 1

      - name: Checkout repository (full fallback)
        if: steps.checkout_shallow.outcome == 'failure'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          clean: true

      - name: Resolve build-binaries artifact
        id: binaries_meta
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: ${{ github.ref_name }}
          REPO: ${{ github.repository }}
        run: |
          set +e
          output="$(python - <<'PY'
          import json
          import os
          import urllib.parse
          import urllib.request

          repo = os.environ.get("REPO")
          branch = os.environ.get("BRANCH") or "main"
          token = os.environ.get("GITHUB_TOKEN")
          workflow_file = "build-binaries.yml"
          artifact_name = "algorithm-binaries-linux"

          if not repo:
              raise SystemExit("REPO env var is missing")
          if not token:
              raise SystemExit("GITHUB_TOKEN env var is missing")

          api_base = f"https://api.github.com/repos/{repo}"
          headers = {
              "Accept": "application/vnd.github+json",
              "Authorization": f"Bearer {token}",
              "X-GitHub-Api-Version": "2022-11-28",
              "User-Agent": "capstone-download-binaries",
          }

          def api_get(path: str):
              url = api_base + path
              req = urllib.request.Request(url, headers=headers)
              with urllib.request.urlopen(req) as resp:
                  return json.load(resp)

          query = urllib.parse.urlencode({"branch": branch, "status": "success", "per_page": 1})
          runs = api_get(f"/actions/workflows/{workflow_file}/runs?{query}")
          workflow_runs = runs.get("workflow_runs") or []
          if not workflow_runs:
              raise SystemExit(
                  f"No successful '{workflow_file}' runs found for branch '{branch}'. "
                  "Run the 'Build Binaries' workflow first."
              )

          run_id = workflow_runs[0].get("id")
          if not run_id:
              raise SystemExit("Could not read run_id from workflow_runs response.")

          artifacts = api_get(f"/actions/runs/{run_id}/artifacts")
          items = artifacts.get("artifacts") or []
          artifact = next(
              (a for a in items if a.get("name") == artifact_name and not a.get("expired")), None
          )
          if not artifact:
              available = ", ".join(sorted({a.get("name", "") for a in items if a.get("name")}))
              raise SystemExit(
                  f"Artifact '{artifact_name}' not found on run {run_id}. "
                  f"Available artifacts: {available or '(none)'}"
              )

          artifact_id = artifact.get("id")
          if not artifact_id:
              raise SystemExit("Could not read artifact id.")

          print(f"{run_id} {artifact_id}")
          PY
          )"
          status=$?
          set -e
          if [ $status -eq 0 ]; then
            run_id="$(echo "$output" | awk '{print $1}')"
            artifact_id="$(echo "$output" | awk '{print $2}')"
            echo "RUN_ID=$run_id" >> "$GITHUB_OUTPUT"
            echo "ARTIFACT_ID=$artifact_id" >> "$GITHUB_OUTPUT"
          else
            echo "$output"
            echo "RUN_ID=" >> "$GITHUB_OUTPUT"
            echo "ARTIFACT_ID=" >> "$GITHUB_OUTPUT"
          fi

      - name: Cache binaries
        id: binaries_cache
        uses: actions/cache@v4
        continue-on-error: true
        with:
          path: |
            baselines/dijkstra
            src/dijkstra_llm
            src/dijkstra_gemini
            src/vf3
            src/chatvf3
            src/glasgow_chatgpt
            src/glasgow_gemini
            baselines/vf3lib/bin/vf3
            baselines/glasgow-subgraph-solver/build/glasgow_subgraph_solver
          key: ${{ runner.os }}-algorithm-binaries-${{ steps.binaries_meta.outputs.RUN_ID || 'unknown' }}

      - name: Download prebuilt binaries
        id: binaries
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: ${{ github.ref_name }}
          REPO: ${{ github.repository }}
          CACHE_HIT: ${{ steps.binaries_cache.outputs.cache-hit }}
          BINARIES_RUN_ID: ${{ steps.binaries_meta.outputs.RUN_ID }}
          BINARIES_ARTIFACT_ID: ${{ steps.binaries_meta.outputs.ARTIFACT_ID }}
        run: |
          mkdir -p outputs
          : > outputs/binaries_download_error.txt
          expected=(
            "baselines/dijkstra"
            "src/dijkstra_llm"
            "src/dijkstra_gemini"
            "src/vf3"
            "src/chatvf3"
            "src/glasgow_chatgpt"
            "src/glasgow_gemini"
            "baselines/vf3lib/bin/vf3"
            "baselines/glasgow-subgraph-solver/build/glasgow_subgraph_solver"
          )
          if [ "${CACHE_HIT:-}" = "true" ]; then
            missing=0
            for rel in "${expected[@]}"; do
              if [ ! -f "$rel" ]; then
                missing=1
                break
              fi
            done
            if [ "$missing" -eq 0 ]; then
              chmod +x "${expected[@]}"
              echo "READY=1" >> "$GITHUB_OUTPUT"
              echo "Using cached binaries (run_id=${BINARIES_RUN_ID:-unknown})."
              exit 0
            fi
          fi
          set +e
          output="$(python - <<'PY'
          import json
          import os
          import stat
          import subprocess
          import urllib.parse
          import urllib.request
          import zipfile
          from pathlib import Path

          repo = os.environ.get("REPO")
          branch = os.environ.get("BRANCH") or "main"
          token = os.environ.get("GITHUB_TOKEN")
          artifact_id = os.environ.get("BINARIES_ARTIFACT_ID")
          run_id = os.environ.get("BINARIES_RUN_ID")
          workflow_file = "build-binaries.yml"
          artifact_name = "algorithm-binaries-linux"

          if not repo:
              raise SystemExit("REPO env var is missing")
          if not token:
              raise SystemExit("GITHUB_TOKEN env var is missing")

          api_base = f"https://api.github.com/repos/{repo}"
          headers = {
              "Accept": "application/vnd.github+json",
              "Authorization": f"Bearer {token}",
              "X-GitHub-Api-Version": "2022-11-28",
              "User-Agent": "capstone-download-binaries",
          }


          def api_get(path: str):
              url = api_base + path
              req = urllib.request.Request(url, headers=headers)
              with urllib.request.urlopen(req) as resp:
                  return json.load(resp)

          if not run_id or not artifact_id:
              query = urllib.parse.urlencode({"branch": branch, "status": "success", "per_page": 1})
              runs = api_get(f"/actions/workflows/{workflow_file}/runs?{query}")
              workflow_runs = runs.get("workflow_runs") or []
              if not workflow_runs:
                  raise SystemExit(
                      f"No successful '{workflow_file}' runs found for branch '{branch}'. "
                      "Run the 'Build Binaries' workflow first."
                  )

              run_id = workflow_runs[0].get("id")
              if not run_id:
                  raise SystemExit("Could not read run_id from workflow_runs response.")

              artifacts = api_get(f"/actions/runs/{run_id}/artifacts")
              items = artifacts.get("artifacts") or []
              artifact = next(
                  (a for a in items if a.get("name") == artifact_name and not a.get("expired")), None
              )
              if not artifact:
                  available = ", ".join(sorted({a.get("name", "") for a in items if a.get("name")}))
                  raise SystemExit(
                      f"Artifact '{artifact_name}' not found on run {run_id}. "
                      f"Available artifacts: {available or '(none)'}"
                  )

              artifact_id = artifact.get("id")
              if not artifact_id:
                  raise SystemExit("Could not read artifact id.")


          zip_path = Path("binaries.zip")
          download_url = f"{api_base}/actions/artifacts/{artifact_id}/zip"
          subprocess.run(
              [
                  "curl",
                  "-fsSL",
                  "-o",
                  str(zip_path),
                  "-H",
                  f"Authorization: Bearer {token}",
                  "-H",
                  "Accept: application/vnd.github+json",
                  download_url,
              ],
              check=True,
          )

          with zipfile.ZipFile(zip_path, "r") as zf:
              zf.extractall(".")

          expected = [
              "baselines/dijkstra",
              "src/dijkstra_llm",
              "src/dijkstra_gemini",
              "src/vf3",
              "src/chatvf3",
              "src/glasgow_chatgpt",
              "src/glasgow_gemini",
              "baselines/vf3lib/bin/vf3",
              "baselines/glasgow-subgraph-solver/build/glasgow_subgraph_solver",
          ]

          missing = []
          for rel in expected:
              p = Path(rel)
              if not p.exists():
                  missing.append(rel)
                  continue
              mode = p.stat().st_mode
              p.chmod(mode | stat.S_IXUSR | stat.S_IXGRP | stat.S_IXOTH)

          if missing:
              raise SystemExit(
                  f"Missing expected binaries after extraction: {', '.join(missing)}"
              )

          print(f"Downloaded artifacts from run {run_id} (artifact_id={artifact_id}).")
          PY
          )"
          status=$?
          set -e
          if [ $status -eq 0 ]; then
            echo "READY=1" >> "$GITHUB_OUTPUT"
          else
            echo "READY=0" >> "$GITHUB_OUTPUT"
            echo "$output" > outputs/binaries_download_error.txt
            echo "$output"
          fi
          exit 0

      - name: Run algorithm
        id: run
        if: ${{ env.ALGORITHM_INPUT != 'subgraph' }}
        env:
          BINARIES_READY: ${{ steps.binaries.outputs.READY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: &run_algorithm_script bash --noprofile --norc -eo pipefail .github/scripts/run-algorithm-step.sh
      - name: Run subgraph phase 1 (VF3)
        id: run_subgraph_vf3
        if: ${{ env.ALGORITHM_INPUT == 'subgraph' }}
        env:
          BINARIES_READY: ${{ steps.binaries.outputs.READY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SUBGRAPH_PHASE_INPUT: vf3
        run: *run_algorithm_script

      - name: Create result JSON (VF3 phase)
        if: ${{ always() && env.ALGORITHM_INPUT == 'subgraph' }}
        env:
          EXIT_CODE: ${{ steps.run_subgraph_vf3.outputs.EXIT_CODE }}
          ITERATIONS: ${{ steps.run_subgraph_vf3.outputs.ITERATIONS }}
          WARMUP: ${{ steps.run_subgraph_vf3.outputs.WARMUP }}
          RUN_DURATION_MS: ${{ steps.run_subgraph_vf3.outputs.RUN_DURATION_MS }}
          SEED_USED: ${{ steps.run_subgraph_vf3.outputs.SEED_USED }}
          SUBGRAPH_PHASE: ${{ steps.run_subgraph_vf3.outputs.SUBGRAPH_PHASE }}
          DIJKSTRA_BASELINE_MS: ${{ steps.run_subgraph_vf3.outputs.DIJKSTRA_BASELINE_MS }}
          DIJKSTRA_LLM_MS: ${{ steps.run_subgraph_vf3.outputs.DIJKSTRA_LLM_MS }}
          DIJKSTRA_BASELINE_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.DIJKSTRA_BASELINE_MS_STDEV }}
          DIJKSTRA_LLM_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.DIJKSTRA_LLM_MS_STDEV }}
          DIJKSTRA_BASELINE_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.DIJKSTRA_BASELINE_RSS_KB }}
          DIJKSTRA_LLM_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.DIJKSTRA_LLM_RSS_KB }}
          DIJKSTRA_BASELINE_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.DIJKSTRA_BASELINE_RSS_KB_STDEV }}
          DIJKSTRA_LLM_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.DIJKSTRA_LLM_RSS_KB_STDEV }}
          GLASGOW_FIRST_MS: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_FIRST_MS }}
          GLASGOW_ALL_MS: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_ALL_MS }}
          GLASGOW_FIRST_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_FIRST_MS_STDEV }}
          GLASGOW_ALL_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_ALL_MS_STDEV }}
          GLASGOW_FIRST_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_FIRST_RSS_KB }}
          GLASGOW_ALL_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_ALL_RSS_KB }}
          GLASGOW_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_FIRST_RSS_KB_STDEV }}
          GLASGOW_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_ALL_RSS_KB_STDEV }}
          GLASGOW_GEMINI_FIRST_MS: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_GEMINI_FIRST_MS }}
          GLASGOW_GEMINI_ALL_MS: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_GEMINI_ALL_MS }}
          GLASGOW_GEMINI_FIRST_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_GEMINI_FIRST_MS_STDEV }}
          GLASGOW_GEMINI_ALL_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_GEMINI_ALL_MS_STDEV }}
          GLASGOW_GEMINI_FIRST_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_GEMINI_FIRST_RSS_KB }}
          GLASGOW_GEMINI_ALL_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_GEMINI_ALL_RSS_KB }}
          GLASGOW_GEMINI_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_GEMINI_FIRST_RSS_KB_STDEV }}
          GLASGOW_GEMINI_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_GEMINI_ALL_RSS_KB_STDEV }}
          GLASGOW_CHATGPT_FIRST_MS: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_CHATGPT_FIRST_MS }}
          GLASGOW_CHATGPT_ALL_MS: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_CHATGPT_ALL_MS }}
          GLASGOW_CHATGPT_FIRST_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_CHATGPT_FIRST_MS_STDEV }}
          GLASGOW_CHATGPT_ALL_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_CHATGPT_ALL_MS_STDEV }}
          GLASGOW_CHATGPT_FIRST_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_CHATGPT_FIRST_RSS_KB }}
          GLASGOW_CHATGPT_ALL_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_CHATGPT_ALL_RSS_KB }}
          GLASGOW_CHATGPT_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_CHATGPT_FIRST_RSS_KB_STDEV }}
          GLASGOW_CHATGPT_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_CHATGPT_ALL_RSS_KB_STDEV }}
          GLASGOW_BASELINE_SUCCESS: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_BASELINE_SUCCESS }}
          GLASGOW_BASELINE_FAILED: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_BASELINE_FAILED }}
          GLASGOW_BASELINE_MATCH: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_BASELINE_MATCH }}
          GLASGOW_BASELINE_TOTAL: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_BASELINE_TOTAL }}
          GLASGOW_BASELINE_MISMATCH: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_BASELINE_MISMATCH }}
          GLASGOW_CHATGPT_MATCH: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_CHATGPT_MATCH }}
          GLASGOW_CHATGPT_TOTAL: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_CHATGPT_TOTAL }}
          GLASGOW_CHATGPT_MISMATCH: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_CHATGPT_MISMATCH }}
          GLASGOW_GEMINI_MATCH: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_GEMINI_MATCH }}
          GLASGOW_GEMINI_TOTAL: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_GEMINI_TOTAL }}
          GLASGOW_GEMINI_MISMATCH: ${{ steps.run_subgraph_vf3.outputs.GLASGOW_GEMINI_MISMATCH }}
          VF3_BASE_FIRST_MS: ${{ steps.run_subgraph_vf3.outputs.VF3_BASE_FIRST_MS }}
          VF3_BASE_ALL_MS: ${{ steps.run_subgraph_vf3.outputs.VF3_BASE_ALL_MS }}
          VF3_BASE_FIRST_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_BASE_FIRST_MS_STDEV }}
          VF3_BASE_ALL_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_BASE_ALL_MS_STDEV }}
          VF3_BASE_FIRST_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.VF3_BASE_FIRST_RSS_KB }}
          VF3_BASE_ALL_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.VF3_BASE_ALL_RSS_KB }}
          VF3_BASE_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_BASE_FIRST_RSS_KB_STDEV }}
          VF3_BASE_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_BASE_ALL_RSS_KB_STDEV }}
          VF3_GEMINI_FIRST_MS: ${{ steps.run_subgraph_vf3.outputs.VF3_GEMINI_FIRST_MS }}
          VF3_GEMINI_ALL_MS: ${{ steps.run_subgraph_vf3.outputs.VF3_GEMINI_ALL_MS }}
          VF3_GEMINI_FIRST_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_GEMINI_FIRST_MS_STDEV }}
          VF3_GEMINI_ALL_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_GEMINI_ALL_MS_STDEV }}
          VF3_GEMINI_FIRST_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.VF3_GEMINI_FIRST_RSS_KB }}
          VF3_GEMINI_ALL_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.VF3_GEMINI_ALL_RSS_KB }}
          VF3_GEMINI_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_GEMINI_FIRST_RSS_KB_STDEV }}
          VF3_GEMINI_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_GEMINI_ALL_RSS_KB_STDEV }}
          VF3_CHATGPT_FIRST_MS: ${{ steps.run_subgraph_vf3.outputs.VF3_CHATGPT_FIRST_MS }}
          VF3_CHATGPT_ALL_MS: ${{ steps.run_subgraph_vf3.outputs.VF3_CHATGPT_ALL_MS }}
          VF3_CHATGPT_FIRST_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_CHATGPT_FIRST_MS_STDEV }}
          VF3_CHATGPT_ALL_MS_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_CHATGPT_ALL_MS_STDEV }}
          VF3_CHATGPT_FIRST_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.VF3_CHATGPT_FIRST_RSS_KB }}
          VF3_CHATGPT_ALL_RSS_KB: ${{ steps.run_subgraph_vf3.outputs.VF3_CHATGPT_ALL_RSS_KB }}
          VF3_CHATGPT_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_CHATGPT_FIRST_RSS_KB_STDEV }}
          VF3_CHATGPT_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_vf3.outputs.VF3_CHATGPT_ALL_RSS_KB_STDEV }}
          VF3_BASELINE_SUCCESS: ${{ steps.run_subgraph_vf3.outputs.VF3_BASELINE_SUCCESS }}
          VF3_BASELINE_FAILED: ${{ steps.run_subgraph_vf3.outputs.VF3_BASELINE_FAILED }}
          VF3_CHATGPT_MATCH: ${{ steps.run_subgraph_vf3.outputs.VF3_CHATGPT_MATCH }}
          VF3_CHATGPT_TOTAL: ${{ steps.run_subgraph_vf3.outputs.VF3_CHATGPT_TOTAL }}
          VF3_CHATGPT_MISMATCH: ${{ steps.run_subgraph_vf3.outputs.VF3_CHATGPT_MISMATCH }}
          VF3_GEMINI_MATCH: ${{ steps.run_subgraph_vf3.outputs.VF3_GEMINI_MATCH }}
          VF3_GEMINI_TOTAL: ${{ steps.run_subgraph_vf3.outputs.VF3_GEMINI_TOTAL }}
          VF3_GEMINI_MISMATCH: ${{ steps.run_subgraph_vf3.outputs.VF3_GEMINI_MISMATCH }}

        run: &create_result_json_script bash --noprofile --norc -eo pipefail .github/scripts/create-result-json-step.sh
      - name: Upload algorithm result (VF3 phase)
        if: ${{ always() && env.ALGORITHM_INPUT == 'subgraph' }}
        uses: actions/upload-artifact@v4
        with:
          name: algorithm-result
          path: outputs/result.json

      - name: Run subgraph phase 2 (Glasgow)
        id: run_subgraph_glasgow
        if: ${{ env.ALGORITHM_INPUT == 'subgraph' }}
        env:
          BINARIES_READY: ${{ steps.binaries.outputs.READY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SUBGRAPH_PHASE_INPUT: glasgow
        run: *run_algorithm_script

      - name: Create result JSON (Glasgow phase)
        if: ${{ always() && env.ALGORITHM_INPUT == 'subgraph' }}
        env:
          EXIT_CODE: ${{ steps.run_subgraph_glasgow.outputs.EXIT_CODE }}
          ITERATIONS: ${{ steps.run_subgraph_glasgow.outputs.ITERATIONS }}
          WARMUP: ${{ steps.run_subgraph_glasgow.outputs.WARMUP }}
          RUN_DURATION_MS: ${{ steps.run_subgraph_glasgow.outputs.RUN_DURATION_MS }}
          SEED_USED: ${{ steps.run_subgraph_glasgow.outputs.SEED_USED }}
          SUBGRAPH_PHASE: ${{ steps.run_subgraph_glasgow.outputs.SUBGRAPH_PHASE }}
          DIJKSTRA_BASELINE_MS: ${{ steps.run_subgraph_glasgow.outputs.DIJKSTRA_BASELINE_MS }}
          DIJKSTRA_LLM_MS: ${{ steps.run_subgraph_glasgow.outputs.DIJKSTRA_LLM_MS }}
          DIJKSTRA_BASELINE_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.DIJKSTRA_BASELINE_MS_STDEV }}
          DIJKSTRA_LLM_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.DIJKSTRA_LLM_MS_STDEV }}
          DIJKSTRA_BASELINE_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.DIJKSTRA_BASELINE_RSS_KB }}
          DIJKSTRA_LLM_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.DIJKSTRA_LLM_RSS_KB }}
          DIJKSTRA_BASELINE_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.DIJKSTRA_BASELINE_RSS_KB_STDEV }}
          DIJKSTRA_LLM_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.DIJKSTRA_LLM_RSS_KB_STDEV }}
          GLASGOW_FIRST_MS: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_FIRST_MS }}
          GLASGOW_ALL_MS: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_ALL_MS }}
          GLASGOW_FIRST_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_FIRST_MS_STDEV }}
          GLASGOW_ALL_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_ALL_MS_STDEV }}
          GLASGOW_FIRST_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_FIRST_RSS_KB }}
          GLASGOW_ALL_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_ALL_RSS_KB }}
          GLASGOW_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_FIRST_RSS_KB_STDEV }}
          GLASGOW_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_ALL_RSS_KB_STDEV }}
          GLASGOW_GEMINI_FIRST_MS: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_GEMINI_FIRST_MS }}
          GLASGOW_GEMINI_ALL_MS: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_GEMINI_ALL_MS }}
          GLASGOW_GEMINI_FIRST_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_GEMINI_FIRST_MS_STDEV }}
          GLASGOW_GEMINI_ALL_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_GEMINI_ALL_MS_STDEV }}
          GLASGOW_GEMINI_FIRST_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_GEMINI_FIRST_RSS_KB }}
          GLASGOW_GEMINI_ALL_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_GEMINI_ALL_RSS_KB }}
          GLASGOW_GEMINI_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_GEMINI_FIRST_RSS_KB_STDEV }}
          GLASGOW_GEMINI_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_GEMINI_ALL_RSS_KB_STDEV }}
          GLASGOW_CHATGPT_FIRST_MS: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_CHATGPT_FIRST_MS }}
          GLASGOW_CHATGPT_ALL_MS: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_CHATGPT_ALL_MS }}
          GLASGOW_CHATGPT_FIRST_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_CHATGPT_FIRST_MS_STDEV }}
          GLASGOW_CHATGPT_ALL_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_CHATGPT_ALL_MS_STDEV }}
          GLASGOW_CHATGPT_FIRST_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_CHATGPT_FIRST_RSS_KB }}
          GLASGOW_CHATGPT_ALL_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_CHATGPT_ALL_RSS_KB }}
          GLASGOW_CHATGPT_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_CHATGPT_FIRST_RSS_KB_STDEV }}
          GLASGOW_CHATGPT_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_CHATGPT_ALL_RSS_KB_STDEV }}
          GLASGOW_BASELINE_SUCCESS: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_BASELINE_SUCCESS }}
          GLASGOW_BASELINE_FAILED: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_BASELINE_FAILED }}
          GLASGOW_BASELINE_MATCH: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_BASELINE_MATCH }}
          GLASGOW_BASELINE_TOTAL: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_BASELINE_TOTAL }}
          GLASGOW_BASELINE_MISMATCH: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_BASELINE_MISMATCH }}
          GLASGOW_CHATGPT_MATCH: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_CHATGPT_MATCH }}
          GLASGOW_CHATGPT_TOTAL: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_CHATGPT_TOTAL }}
          GLASGOW_CHATGPT_MISMATCH: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_CHATGPT_MISMATCH }}
          GLASGOW_GEMINI_MATCH: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_GEMINI_MATCH }}
          GLASGOW_GEMINI_TOTAL: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_GEMINI_TOTAL }}
          GLASGOW_GEMINI_MISMATCH: ${{ steps.run_subgraph_glasgow.outputs.GLASGOW_GEMINI_MISMATCH }}
          VF3_BASE_FIRST_MS: ${{ steps.run_subgraph_glasgow.outputs.VF3_BASE_FIRST_MS }}
          VF3_BASE_ALL_MS: ${{ steps.run_subgraph_glasgow.outputs.VF3_BASE_ALL_MS }}
          VF3_BASE_FIRST_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_BASE_FIRST_MS_STDEV }}
          VF3_BASE_ALL_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_BASE_ALL_MS_STDEV }}
          VF3_BASE_FIRST_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.VF3_BASE_FIRST_RSS_KB }}
          VF3_BASE_ALL_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.VF3_BASE_ALL_RSS_KB }}
          VF3_BASE_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_BASE_FIRST_RSS_KB_STDEV }}
          VF3_BASE_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_BASE_ALL_RSS_KB_STDEV }}
          VF3_GEMINI_FIRST_MS: ${{ steps.run_subgraph_glasgow.outputs.VF3_GEMINI_FIRST_MS }}
          VF3_GEMINI_ALL_MS: ${{ steps.run_subgraph_glasgow.outputs.VF3_GEMINI_ALL_MS }}
          VF3_GEMINI_FIRST_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_GEMINI_FIRST_MS_STDEV }}
          VF3_GEMINI_ALL_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_GEMINI_ALL_MS_STDEV }}
          VF3_GEMINI_FIRST_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.VF3_GEMINI_FIRST_RSS_KB }}
          VF3_GEMINI_ALL_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.VF3_GEMINI_ALL_RSS_KB }}
          VF3_GEMINI_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_GEMINI_FIRST_RSS_KB_STDEV }}
          VF3_GEMINI_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_GEMINI_ALL_RSS_KB_STDEV }}
          VF3_CHATGPT_FIRST_MS: ${{ steps.run_subgraph_glasgow.outputs.VF3_CHATGPT_FIRST_MS }}
          VF3_CHATGPT_ALL_MS: ${{ steps.run_subgraph_glasgow.outputs.VF3_CHATGPT_ALL_MS }}
          VF3_CHATGPT_FIRST_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_CHATGPT_FIRST_MS_STDEV }}
          VF3_CHATGPT_ALL_MS_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_CHATGPT_ALL_MS_STDEV }}
          VF3_CHATGPT_FIRST_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.VF3_CHATGPT_FIRST_RSS_KB }}
          VF3_CHATGPT_ALL_RSS_KB: ${{ steps.run_subgraph_glasgow.outputs.VF3_CHATGPT_ALL_RSS_KB }}
          VF3_CHATGPT_FIRST_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_CHATGPT_FIRST_RSS_KB_STDEV }}
          VF3_CHATGPT_ALL_RSS_KB_STDEV: ${{ steps.run_subgraph_glasgow.outputs.VF3_CHATGPT_ALL_RSS_KB_STDEV }}
          VF3_BASELINE_SUCCESS: ${{ steps.run_subgraph_glasgow.outputs.VF3_BASELINE_SUCCESS }}
          VF3_BASELINE_FAILED: ${{ steps.run_subgraph_glasgow.outputs.VF3_BASELINE_FAILED }}
          VF3_CHATGPT_MATCH: ${{ steps.run_subgraph_glasgow.outputs.VF3_CHATGPT_MATCH }}
          VF3_CHATGPT_TOTAL: ${{ steps.run_subgraph_glasgow.outputs.VF3_CHATGPT_TOTAL }}
          VF3_CHATGPT_MISMATCH: ${{ steps.run_subgraph_glasgow.outputs.VF3_CHATGPT_MISMATCH }}
          VF3_GEMINI_MATCH: ${{ steps.run_subgraph_glasgow.outputs.VF3_GEMINI_MATCH }}
          VF3_GEMINI_TOTAL: ${{ steps.run_subgraph_glasgow.outputs.VF3_GEMINI_TOTAL }}
          VF3_GEMINI_MISMATCH: ${{ steps.run_subgraph_glasgow.outputs.VF3_GEMINI_MISMATCH }}
        run: *create_result_json_script


      - name: Upload algorithm result (Glasgow phase)
        if: ${{ always() && env.ALGORITHM_INPUT == 'subgraph' }}
        uses: actions/upload-artifact@v4
        with:
          name: algorithm-result
          path: outputs/result.json
          overwrite: true

      - name: Create result JSON
        if: ${{ always() && env.ALGORITHM_INPUT != 'subgraph' }}
        env:
          EXIT_CODE: ${{ steps.run.outputs.EXIT_CODE }}
          ITERATIONS: ${{ steps.run.outputs.ITERATIONS }}
          WARMUP: ${{ steps.run.outputs.WARMUP }}
          RUN_DURATION_MS: ${{ steps.run.outputs.RUN_DURATION_MS }}
          SUBGRAPH_PHASE: ${{ steps.run.outputs.SUBGRAPH_PHASE }}
          SEED_USED: ${{ steps.run.outputs.SEED_USED }}
          DIJKSTRA_BASELINE_MS: ${{ steps.run.outputs.DIJKSTRA_BASELINE_MS }}
          DIJKSTRA_LLM_MS: ${{ steps.run.outputs.DIJKSTRA_LLM_MS }}
          DIJKSTRA_GEMINI_MS: ${{ steps.run.outputs.DIJKSTRA_GEMINI_MS }}
          DIJKSTRA_BASELINE_MS_STDEV: ${{ steps.run.outputs.DIJKSTRA_BASELINE_MS_STDEV }}
          DIJKSTRA_LLM_MS_STDEV: ${{ steps.run.outputs.DIJKSTRA_LLM_MS_STDEV }}
          DIJKSTRA_GEMINI_MS_STDEV: ${{ steps.run.outputs.DIJKSTRA_GEMINI_MS_STDEV }}
          DIJKSTRA_BASELINE_RSS_KB: ${{ steps.run.outputs.DIJKSTRA_BASELINE_RSS_KB }}
          DIJKSTRA_LLM_RSS_KB: ${{ steps.run.outputs.DIJKSTRA_LLM_RSS_KB }}
          DIJKSTRA_GEMINI_RSS_KB: ${{ steps.run.outputs.DIJKSTRA_GEMINI_RSS_KB }}
          DIJKSTRA_BASELINE_RSS_KB_STDEV: ${{ steps.run.outputs.DIJKSTRA_BASELINE_RSS_KB_STDEV }}
          DIJKSTRA_LLM_RSS_KB_STDEV: ${{ steps.run.outputs.DIJKSTRA_LLM_RSS_KB_STDEV }}
          DIJKSTRA_GEMINI_RSS_KB_STDEV: ${{ steps.run.outputs.DIJKSTRA_GEMINI_RSS_KB_STDEV }}
          DIJKSTRA_CHATGPT_MATCH: ${{ steps.run.outputs.DIJKSTRA_CHATGPT_MATCH }}
          DIJKSTRA_CHATGPT_TOTAL: ${{ steps.run.outputs.DIJKSTRA_CHATGPT_TOTAL }}
          DIJKSTRA_CHATGPT_MISMATCH: ${{ steps.run.outputs.DIJKSTRA_CHATGPT_MISMATCH }}
          DIJKSTRA_MATCH: ${{ steps.run.outputs.DIJKSTRA_MATCH }}
          DIJKSTRA_TOTAL: ${{ steps.run.outputs.DIJKSTRA_TOTAL }}
          DIJKSTRA_MISMATCH: ${{ steps.run.outputs.DIJKSTRA_MISMATCH }}
          DIJKSTRA_GEMINI_MATCH: ${{ steps.run.outputs.DIJKSTRA_GEMINI_MATCH }}
          DIJKSTRA_GEMINI_TOTAL: ${{ steps.run.outputs.DIJKSTRA_GEMINI_TOTAL }}
          DIJKSTRA_GEMINI_MISMATCH: ${{ steps.run.outputs.DIJKSTRA_GEMINI_MISMATCH }}
          GLASGOW_FIRST_MS: ${{ steps.run.outputs.GLASGOW_FIRST_MS }}
          GLASGOW_ALL_MS: ${{ steps.run.outputs.GLASGOW_ALL_MS }}
          GLASGOW_FIRST_MS_STDEV: ${{ steps.run.outputs.GLASGOW_FIRST_MS_STDEV }}
          GLASGOW_ALL_MS_STDEV: ${{ steps.run.outputs.GLASGOW_ALL_MS_STDEV }}
          GLASGOW_FIRST_RSS_KB: ${{ steps.run.outputs.GLASGOW_FIRST_RSS_KB }}
          GLASGOW_ALL_RSS_KB: ${{ steps.run.outputs.GLASGOW_ALL_RSS_KB }}
          GLASGOW_FIRST_RSS_KB_STDEV: ${{ steps.run.outputs.GLASGOW_FIRST_RSS_KB_STDEV }}
          GLASGOW_ALL_RSS_KB_STDEV: ${{ steps.run.outputs.GLASGOW_ALL_RSS_KB_STDEV }}
          GLASGOW_GEMINI_FIRST_MS: ${{ steps.run.outputs.GLASGOW_GEMINI_FIRST_MS }}
          GLASGOW_GEMINI_ALL_MS: ${{ steps.run.outputs.GLASGOW_GEMINI_ALL_MS }}
          GLASGOW_GEMINI_FIRST_MS_STDEV: ${{ steps.run.outputs.GLASGOW_GEMINI_FIRST_MS_STDEV }}
          GLASGOW_GEMINI_ALL_MS_STDEV: ${{ steps.run.outputs.GLASGOW_GEMINI_ALL_MS_STDEV }}
          GLASGOW_GEMINI_FIRST_RSS_KB: ${{ steps.run.outputs.GLASGOW_GEMINI_FIRST_RSS_KB }}
          GLASGOW_GEMINI_ALL_RSS_KB: ${{ steps.run.outputs.GLASGOW_GEMINI_ALL_RSS_KB }}
          GLASGOW_GEMINI_FIRST_RSS_KB_STDEV: ${{ steps.run.outputs.GLASGOW_GEMINI_FIRST_RSS_KB_STDEV }}
          GLASGOW_GEMINI_ALL_RSS_KB_STDEV: ${{ steps.run.outputs.GLASGOW_GEMINI_ALL_RSS_KB_STDEV }}
          GLASGOW_CHATGPT_FIRST_MS: ${{ steps.run.outputs.GLASGOW_CHATGPT_FIRST_MS }}
          GLASGOW_CHATGPT_ALL_MS: ${{ steps.run.outputs.GLASGOW_CHATGPT_ALL_MS }}
          GLASGOW_CHATGPT_FIRST_MS_STDEV: ${{ steps.run.outputs.GLASGOW_CHATGPT_FIRST_MS_STDEV }}
          GLASGOW_CHATGPT_ALL_MS_STDEV: ${{ steps.run.outputs.GLASGOW_CHATGPT_ALL_MS_STDEV }}
          GLASGOW_CHATGPT_FIRST_RSS_KB: ${{ steps.run.outputs.GLASGOW_CHATGPT_FIRST_RSS_KB }}
          GLASGOW_CHATGPT_ALL_RSS_KB: ${{ steps.run.outputs.GLASGOW_CHATGPT_ALL_RSS_KB }}
          GLASGOW_CHATGPT_FIRST_RSS_KB_STDEV: ${{ steps.run.outputs.GLASGOW_CHATGPT_FIRST_RSS_KB_STDEV }}
          GLASGOW_CHATGPT_ALL_RSS_KB_STDEV: ${{ steps.run.outputs.GLASGOW_CHATGPT_ALL_RSS_KB_STDEV }}
          GLASGOW_BASELINE_SUCCESS: ${{ steps.run.outputs.GLASGOW_BASELINE_SUCCESS }}
          GLASGOW_BASELINE_FAILED: ${{ steps.run.outputs.GLASGOW_BASELINE_FAILED }}
          GLASGOW_BASELINE_MATCH: ${{ steps.run.outputs.GLASGOW_BASELINE_MATCH }}
          GLASGOW_BASELINE_TOTAL: ${{ steps.run.outputs.GLASGOW_BASELINE_TOTAL }}
          GLASGOW_BASELINE_MISMATCH: ${{ steps.run.outputs.GLASGOW_BASELINE_MISMATCH }}
          GLASGOW_CHATGPT_MATCH: ${{ steps.run.outputs.GLASGOW_CHATGPT_MATCH }}
          GLASGOW_CHATGPT_TOTAL: ${{ steps.run.outputs.GLASGOW_CHATGPT_TOTAL }}
          GLASGOW_CHATGPT_MISMATCH: ${{ steps.run.outputs.GLASGOW_CHATGPT_MISMATCH }}
          GLASGOW_GEMINI_MATCH: ${{ steps.run.outputs.GLASGOW_GEMINI_MATCH }}
          GLASGOW_GEMINI_TOTAL: ${{ steps.run.outputs.GLASGOW_GEMINI_TOTAL }}
          GLASGOW_GEMINI_MISMATCH: ${{ steps.run.outputs.GLASGOW_GEMINI_MISMATCH }}
          VF3_BASE_FIRST_MS: ${{ steps.run.outputs.VF3_BASE_FIRST_MS }}
          VF3_BASE_ALL_MS: ${{ steps.run.outputs.VF3_BASE_ALL_MS }}
          VF3_BASE_FIRST_MS_STDEV: ${{ steps.run.outputs.VF3_BASE_FIRST_MS_STDEV }}
          VF3_BASE_ALL_MS_STDEV: ${{ steps.run.outputs.VF3_BASE_ALL_MS_STDEV }}
          VF3_BASE_FIRST_RSS_KB: ${{ steps.run.outputs.VF3_BASE_FIRST_RSS_KB }}
          VF3_BASE_ALL_RSS_KB: ${{ steps.run.outputs.VF3_BASE_ALL_RSS_KB }}
          VF3_BASE_FIRST_RSS_KB_STDEV: ${{ steps.run.outputs.VF3_BASE_FIRST_RSS_KB_STDEV }}
          VF3_BASE_ALL_RSS_KB_STDEV: ${{ steps.run.outputs.VF3_BASE_ALL_RSS_KB_STDEV }}
          VF3_GEMINI_FIRST_MS: ${{ steps.run.outputs.VF3_GEMINI_FIRST_MS }}
          VF3_GEMINI_ALL_MS: ${{ steps.run.outputs.VF3_GEMINI_ALL_MS }}
          VF3_GEMINI_FIRST_MS_STDEV: ${{ steps.run.outputs.VF3_GEMINI_FIRST_MS_STDEV }}
          VF3_GEMINI_ALL_MS_STDEV: ${{ steps.run.outputs.VF3_GEMINI_ALL_MS_STDEV }}
          VF3_GEMINI_FIRST_RSS_KB: ${{ steps.run.outputs.VF3_GEMINI_FIRST_RSS_KB }}
          VF3_GEMINI_ALL_RSS_KB: ${{ steps.run.outputs.VF3_GEMINI_ALL_RSS_KB }}
          VF3_GEMINI_FIRST_RSS_KB_STDEV: ${{ steps.run.outputs.VF3_GEMINI_FIRST_RSS_KB_STDEV }}
          VF3_GEMINI_ALL_RSS_KB_STDEV: ${{ steps.run.outputs.VF3_GEMINI_ALL_RSS_KB_STDEV }}
          VF3_CHATGPT_FIRST_MS: ${{ steps.run.outputs.VF3_CHATGPT_FIRST_MS }}
          VF3_CHATGPT_ALL_MS: ${{ steps.run.outputs.VF3_CHATGPT_ALL_MS }}
          VF3_CHATGPT_FIRST_MS_STDEV: ${{ steps.run.outputs.VF3_CHATGPT_FIRST_MS_STDEV }}
          VF3_CHATGPT_ALL_MS_STDEV: ${{ steps.run.outputs.VF3_CHATGPT_ALL_MS_STDEV }}
          VF3_CHATGPT_FIRST_RSS_KB: ${{ steps.run.outputs.VF3_CHATGPT_FIRST_RSS_KB }}
          VF3_CHATGPT_ALL_RSS_KB: ${{ steps.run.outputs.VF3_CHATGPT_ALL_RSS_KB }}
          VF3_CHATGPT_FIRST_RSS_KB_STDEV: ${{ steps.run.outputs.VF3_CHATGPT_FIRST_RSS_KB_STDEV }}
          VF3_CHATGPT_ALL_RSS_KB_STDEV: ${{ steps.run.outputs.VF3_CHATGPT_ALL_RSS_KB_STDEV }}
          VF3_BASELINE_SUCCESS: ${{ steps.run.outputs.VF3_BASELINE_SUCCESS }}
          VF3_BASELINE_FAILED: ${{ steps.run.outputs.VF3_BASELINE_FAILED }}
          VF3_CHATGPT_MATCH: ${{ steps.run.outputs.VF3_CHATGPT_MATCH }}
          VF3_CHATGPT_TOTAL: ${{ steps.run.outputs.VF3_CHATGPT_TOTAL }}
          VF3_CHATGPT_MISMATCH: ${{ steps.run.outputs.VF3_CHATGPT_MISMATCH }}
          VF3_GEMINI_MATCH: ${{ steps.run.outputs.VF3_GEMINI_MATCH }}
          VF3_GEMINI_TOTAL: ${{ steps.run.outputs.VF3_GEMINI_TOTAL }}
          VF3_GEMINI_MISMATCH: ${{ steps.run.outputs.VF3_GEMINI_MISMATCH }}
        run: *create_result_json_script

      - name: Upload generated graphs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: generated-graphs-${{ steps.run_subgraph_vf3.outputs.REQUEST_ID || steps.run.outputs.REQUEST_ID || github.run_id }}
          path: outputs/generated
          if-no-files-found: ignore
          retention-days: 30

      - name: Upload visualization data
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: visualization-data-${{ steps.run_subgraph_vf3.outputs.REQUEST_ID || steps.run.outputs.REQUEST_ID || github.run_id }}
          path: outputs/visualization.json
          if-no-files-found: ignore
          retention-days: 14
      - name: Upload results artifact
        if: ${{ always() && env.ALGORITHM_INPUT != 'subgraph' }}
        uses: actions/upload-artifact@v4
        with:
          name: algorithm-result
          path: outputs/result.json
          if-no-files-found: error
          retention-days: 14
