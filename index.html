<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algorithm Runner Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #24292e 0%, #1a1e22 100%);
            color: white;
            padding: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .config-section {
            background: #f6f8fa;
            padding: 20px 30px;
            border-bottom: 1px solid #e1e4e8;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #24292e;
            font-size: 14px;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5da;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #0366d6;
            box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.1);
        }
        
        .btn {
            background: #2ea44f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
            margin-right: 10px;
        }
        
        .btn:hover {
            background: #2c974b;
        }
        
        .btn:disabled {
            background: #94d3a2;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: #0366d6;
        }
        
        .btn-primary:hover {
            background: #0256c7;
        }
        
        .btn-primary:disabled {
            background: #81b4e0;
        }
        
        .content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .panel {
            background: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 20px;
        }
        
        .panel h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #24292e;
        }
        
        .algorithm-card {
            background: white;
            border: 2px solid #e1e4e8;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .algorithm-card:hover {
            border-color: #0366d6;
            box-shadow: 0 4px 12px rgba(3, 102, 214, 0.1);
        }
        
        .algorithm-card.selected {
            border-color: #0366d6;
            background: #f1f8ff;
        }
        
        .algorithm-card h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #24292e;
        }
        
        .algorithm-card p {
            font-size: 13px;
            color: #586069;
            margin-bottom: 8px;
        }
        
        .algorithm-card .command {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: #f6f8fa;
            padding: 8px;
            border-radius: 4px;
            color: #0366d6;
            margin-top: 8px;
        }
        
        .file-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .file-item {
            padding: 10px;
            border-bottom: 1px solid #e1e4e8;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background 0.2s;
            background: white;
            margin-bottom: 5px;
            border-radius: 4px;
        }
        
        .file-item:hover {
            background: #f1f8ff;
        }
        
        .file-item.selected {
            background: #0366d6;
            color: white;
        }
        
        .file-icon {
            margin-right: 10px;
            font-size: 16px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #586069;
        }
        
        .error {
            background: #ffeef0;
            color: #d73a49;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #f97583;
        }
        
        .success {
            background: #dcffe4;
            color: #22863a;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #34d058;
        }
        
        .info {
            background: #f1f8ff;
            color: #0366d6;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #c8e1ff;
        }
        
        .output-section {
            grid-column: 1 / -1;
        }
        
        .output-content {
            background: #24292e;
            color: #f6f8fa;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .run-controls {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e1e4e8;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-ready {
            background: #dcffe4;
            color: #22863a;
        }
        
        .status-running {
            background: #fff5b1;
            color: #735c0f;
        }
        
        .status-error {
            background: #ffeef0;
            color: #d73a49;
        }
        
        .input-params {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        
        .param-group {
            margin-bottom: 15px;
        }
        
        .param-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #24292e;
        }
        
        .selected-files {
            background: #f1f8ff;
            padding: 10px;
            border-radius: 4px;
            font-size: 13px;
            color: #0366d6;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Algorithm Runner Interface</h1>
            <p>Run graph algorithms on your repository data</p>
        </div>
        
        <div class="config-section">
            <div class="input-group">
                <label>GitHub Username/Org</label>
                <input type="text" id="owner" placeholder="marcopolo866">
            </div>
            <div class="input-group">
                <label>Repository Name</label>
                <input type="text" id="repo" placeholder="Capstone">
            </div>
            <div class="input-group">
                <label>Personal Access Token (Required for running algorithms)</label>
                <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxx">
            </div>
            <button class="btn" onclick="connect()">Connect to Repository</button>
        </div>
        
        <div class="content">
            <div class="panel">
                <h2>Select Algorithm</h2>
                <div id="algorithms-list">
                    <div class="algorithm-card" onclick="selectAlgorithm('dijkstra')">
                        <h3>Dijkstra's Algorithm</h3>
                        <p>Shortest path algorithm for weighted graphs</p>
                        <div class="command">./baselines/dijkstra [input-file]</div>
                    </div>
                    
                    <div class="algorithm-card" onclick="selectAlgorithm('glasgow')">
                        <h3>Glasgow Subgraph Solver</h3>
                        <p>Subgraph isomorphism solver</p>
                        <div class="command">./build/glasgow_subgraph_solver [pattern] [target]</div>
                    </div>
                    
                    <div class="algorithm-card" onclick="selectAlgorithm('vf3')">
                        <h3>VF3 Algorithm</h3>
                        <p>Graph matching algorithm</p>
                        <div class="command">./bin/vf3 [subgraph] [graph]</div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2>Select Input Files</h2>
                <div id="status-message"></div>
                <div id="files-content">
                    <p class="loading">Connect to repository to browse data files</p>
                </div>
            </div>
            
            <div class="panel output-section">
                <h2>Run Algorithm 
                    <span id="status-badge"></span>
                </h2>
                
                <div id="run-info"></div>
                
                <div class="run-controls">
                    <button class="btn btn-primary" id="run-btn" onclick="runAlgorithm()" disabled>
                        Run Algorithm
                    </button>
                    <button class="btn" onclick="clearOutput()">Clear Output</button>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3 style="margin-bottom: 10px;">Output:</h3>
                    <div class="output-content" id="output">
No output yet. Select an algorithm and input files, then click "Run Algorithm".
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let config = {
            owner: '',
            repo: '',
            token: '',
            selectedAlgorithm: null,
            selectedFiles: []
        };
        
        const algorithmConfigs = {
            dijkstra: {
                name: "Dijkstra's Algorithm",
                requiredFiles: 1,
                fileTypes: ['.txt', '.csv', '.grf']
            },
            glasgow: {
                name: "Glasgow Subgraph Solver",
                requiredFiles: 2,
                fileTypes: ['.grf'],
                fileLabels: ['Pattern File', 'Target File']
            },
            vf3: {
                name: "VF3 Algorithm",
                requiredFiles: 2,
                fileTypes: ['.grf'],
                fileLabels: ['Subgraph File', 'Graph File']
            }
        };
        
        function selectAlgorithm(algoId) {
            config.selectedAlgorithm = algoId;
            config.selectedFiles = [];
            
            document.querySelectorAll('.algorithm-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            updateRunButton();
            updateRunInfo();
            
            if (config.owner && config.repo) {
                loadDataFiles();
            }
        }
        
        async function connect() {
            const owner = document.getElementById('owner').value.trim();
            const repo = document.getElementById('repo').value.trim();
            const token = document.getElementById('token').value.trim();
            
            if (!owner || !repo) {
                showStatus('Please enter both username/org and repository name', 'error');
                return;
            }
            
            if (!token) {
                showStatus('Personal Access Token is required to run algorithms', 'error');
                return;
            }
            
            config.owner = owner;
            config.repo = repo;
            config.token = token;
            
            showStatus('Connected successfully!', 'success');
            await loadDataFiles();
        }
        
        async function loadDataFiles() {
            const container = document.getElementById('files-content');
            container.innerHTML = '<p class="loading">Loading data files...</p>';
            
            try {
                const contents = await apiRequest('/contents/data');
                
                let html = '<ul class="file-list">';
                
                const files = Array.isArray(contents) ? contents : [contents];
                
                files.forEach(item => {
                    if (item.type === 'file') {
                        const icon = '📄';
                        html += `
                            <li class="file-item" onclick="toggleFileSelection('${item.path}', '${item.name}')">
                                <span class="file-icon">${icon}</span>
                                <span>${item.name}</span>
                            </li>
                        `;
                    }
                });
                
                html += '</ul>';
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = `<div class="error">Error loading files: ${escapeHtml(error.message)}</div>`;
            }
        }
        
        function toggleFileSelection(path, name) {
            const algo = algorithmConfigs[config.selectedAlgorithm];
            if (!algo) {
                showStatus('Please select an algorithm first', 'error');
                return;
            }
            
            const index = config.selectedFiles.findIndex(f => f.path === path);
            
            if (index > -1) {
                config.selectedFiles.splice(index, 1);
                event.currentTarget.classList.remove('selected');
            } else {
                if (config.selectedFiles.length >= algo.requiredFiles) {
                    showStatus(`This algorithm requires exactly ${algo.requiredFiles} file(s)`, 'error');
                    return;
                }
                config.selectedFiles.push({ path, name });
                event.currentTarget.classList.add('selected');
            }
            
            updateRunButton();
            updateRunInfo();
        }
        
        function updateRunButton() {
            const btn = document.getElementById('run-btn');
            const algo = algorithmConfigs[config.selectedAlgorithm];
            
            if (algo && config.selectedFiles.length === algo.requiredFiles && config.token) {
                btn.disabled = false;
            } else {
                btn.disabled = true;
            }
        }
        
        function updateRunInfo() {
            const infoDiv = document.getElementById('run-info');
            const algo = algorithmConfigs[config.selectedAlgorithm];
            
            if (!algo) {
                infoDiv.innerHTML = '<div class="info">Select an algorithm above to get started</div>';
                return;
            }
            
            let html = `<div class="info">
                <strong>Algorithm:</strong> ${algo.name}<br>
                <strong>Required files:</strong> ${algo.requiredFiles}
            `;
            
            if (config.selectedFiles.length > 0) {
                html += '<div class="selected-files"><strong>Selected:</strong> ';
                html += config.selectedFiles.map((f, i) => {
                    const label = algo.fileLabels ? algo.fileLabels[i] : `File ${i+1}`;
                    return `${label}: ${f.name}`;
                }).join(', ');
                html += '</div>';
            }
            
            html += '</div>';
            infoDiv.innerHTML = html;
        }
        
        async function runAlgorithm() {
            const outputDiv = document.getElementById('output');
            const statusBadge = document.getElementById('status-badge');
            const runBtn = document.getElementById('run-btn');
            
            runBtn.disabled = true;
            statusBadge.innerHTML = '<span class="status-badge status-running">⏳ Running...</span>';
            outputDiv.textContent = 'Triggering GitHub Action workflow...\n\n';
            
            try {
                // Trigger GitHub Action workflow
                const workflowData = {
                    ref: 'main',
                    inputs: {
                        algorithm: config.selectedAlgorithm,
                        input_files: config.selectedFiles.map(f => f.path).join(',')
                    }
                };
                
                await apiRequest('/actions/workflows/run-algorithm.yml/dispatches', 'POST', workflowData);
                
                outputDiv.textContent += '✓ Workflow triggered successfully!\n\n';
                outputDiv.textContent += 'Waiting for results...\n';
                outputDiv.textContent += '(This may take 30-60 seconds for GitHub Actions to start)\n\n';
                
                // Poll for results
                await pollForResults();
                
            } catch (error) {
                outputDiv.textContent += `\nError: ${error.message}\n\n`;
                outputDiv.textContent += 'Make sure you have:\n';
                outputDiv.textContent += '1. Created the GitHub Action workflow file\n';
                outputDiv.textContent += '2. Given your token "repo" and "workflow" permissions\n';
                statusBadge.innerHTML = '<span class="status-badge status-error">Error</span>';
            }
            
            runBtn.disabled = false;
        }
        
        async function pollForResults() {
            const outputDiv = document.getElementById('output');
            const statusBadge = document.getElementById('status-badge');
            const maxAttempts = 30;
            let attempts = 0;
            
            const poll = async () => {
                attempts++;
                
                try {
                    const result = await apiRequest('/contents/outputs/result.json');
                    const content = JSON.parse(atob(result.content));
                    
                    outputDiv.textContent = '═══════════════════════════════════════\n';
                    outputDiv.textContent += `Algorithm: ${content.algorithm}\n`;
                    outputDiv.textContent += `Timestamp: ${content.timestamp}\n`;
                    outputDiv.textContent += `Status: ${content.status}\n`;
                    outputDiv.textContent += '═══════════════════════════════════════\n\n';
                    
                    if (content.status === 'success') {
                        outputDiv.textContent += content.output;
                        statusBadge.innerHTML = '<span class="status-badge status-ready">✓ Complete</span>';
                    } else {
                        outputDiv.textContent += 'Error:\n' + content.error;
                        statusBadge.innerHTML = '<span class="status-badge status-error">Failed</span>';
                    }
                    
                } catch (error) {
                    if (attempts < maxAttempts) {
                        outputDiv.textContent += `Checking... (${attempts}/${maxAttempts})\n`;
                        setTimeout(poll, 3000);
                    } else {
                        outputDiv.textContent += '\n Timeout: Results not found after 90 seconds\n';
                        outputDiv.textContent += 'Check the Actions tab in your GitHub repo for details\n';
                        statusBadge.innerHTML = '<span class="status-badge status-error">Timeout</span>';
                    }
                }
            };
            
            setTimeout(poll, 5000);
        }
        
        function clearOutput() {
            document.getElementById('output').textContent = 'Output cleared.';
            document.getElementById('status-badge').innerHTML = '';
        }
        
        async function apiRequest(endpoint, method = 'GET', body = null) {
            const headers = {
                'Accept': 'application/vnd.github.v3+json'
            };
            
            if (config.token) {
                headers['Authorization'] = `token ${config.token}`;
            }
            
            const options = {
                method: method,
                headers: headers
            };
            
            if (body) {
                options.body = JSON.stringify(body);
            }
            
            const response = await fetch(`https://api.github.com/repos/${config.owner}/${config.repo}${endpoint}`, options);
            
            if (!response.ok) {
                throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
            }
            
            if (method === 'POST' && response.status === 204) {
                return { success: true };
            }
            
            return await response.json();
        }
        
        function showStatus(message, type) {
            const container = document.getElementById('status-message');
            container.innerHTML = `<div class="${type}">${escapeHtml(message)}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
