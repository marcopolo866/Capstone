<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algorithm Runner Interface</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cytoscape@3.29.2/dist/cytoscape.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Algorithm Runner Interface</h1>
            <p>Run graph algorithms on your repository data</p>
        </div>
        
        <div class="config-section">
            <div class="input-group">
                <label>GitHub Username/Org</label>
                <input type="text" id="owner" placeholder="marcopolo866" value="marcopolo866">
            </div>
            <div class="input-group">
                <label>Repository Name</label>
                <input type="text" id="repo" placeholder="Capstone" value="Capstone">
            </div>
            <div class="input-group">
                <label>Personal Access Token (Required for running algorithms)</label>
                <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxx">
            </div>
            <button class="btn" onclick="connect()">Connect to Repository</button>
        </div>
        
        <div class="content">
            <div class="panel">
                <h2>Select Algorithm</h2>
                <div id="algorithms-list">
                    <div class="algorithm-card" onclick="selectAlgorithm(event, 'dijkstra')">
                        <h3>Dijkstra's Algorithm</h3>
                        <p>Shortest path algorithm for weighted graphs</p>
                        <div class="command">./baselines/dijkstra [input-file]</div>
                    </div>
                    
                    <div class="algorithm-card" onclick="selectAlgorithm(event, 'glasgow')">
                        <h3>Glasgow Subgraph Solver</h3>
                        <p>Subgraph isomorphism solver</p>
                        <div class="command">./build/glasgow_subgraph_solver [pattern] [target]</div>
                    </div>
                    
                    <div class="algorithm-card" onclick="selectAlgorithm(event, 'vf3')">
                        <h3>VF3 Algorithm</h3>
                        <p>Graph matching algorithm</p>
                        <div class="command">./bin/vf3 [subgraph] [graph]</div>
                    </div>

                    <div class="algorithm-card" onclick="selectAlgorithm(event, 'subgraph')">
                        <h3>Subgraph Isomorphism (Combined)</h3>
                        <p>Runs VF3, Glasgow, and LLM variants on identical graphs</p>
                        <div class="command">VF3 + Glasgow + LLM comparisons</div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2>Select Input Files</h2>
                <div id="status-message"></div>
                <div class="input-group">
                    <label>Input Source</label>
                    <select id="input-mode" onchange="onInputModeChange()">
                        <option value="premade">Premade graphs</option>
                        <option value="generate" selected>Generate graphs</option>
                    </select>
                    <div class="inline-note" id="generator-disabled-note" hidden>
                        Generator mode is only available for GitHub Actions runs.
                    </div>
                </div>
                <div class="generator-form" id="generator-form" hidden>
                    <div class="input-group">
                        <label>N (target graph node count)</label>
                        <input type="number" id="gen-n" min="2" value="100" placeholder="e.g., 200" oninput="onGeneratorInputChange()">
                    </div>
                    <div class="input-group" id="gen-k-group">
                        <label>k (pattern/subgraph node count, k &lt; N)</label>
                        <input type="number" id="gen-k" min="1" value="10" placeholder="e.g., 40" oninput="onGeneratorInputChange()">
                    </div>
                    <div class="input-group">
                        <label>Density (fraction of possible edges, 0-1)</label>
                        <input type="number" id="gen-density" min="0.01" max="1" step="0.01" value="0.01" oninput="onGeneratorInputChange()">
                    </div>
                    <div class="input-group">
                        <label>Seed (optional, integer)</label>
                        <input type="number" id="gen-seed" step="1" placeholder="Leave blank for random" oninput="onGeneratorInputChange()">
                    </div>
                    <div class="inline-note" id="generator-estimate" hidden></div>
                    <div class="inline-warning" id="generator-warning" hidden>
                        k must be smaller than N.
                    </div>
                    <div class="inline-warning" id="generator-seed-warning" hidden>
                        Seed must be an integer.
                    </div>
                </div>
                <div id="files-content">
                    <p class="loading">Connect to repository to browse data files</p>
                </div>
            </div>
            
            <div class="panel output-section">
                <h2>Run Algorithm 
                    <span id="status-badge"></span>
                </h2>
                
                <div id="run-info"></div>
                
                <div class="run-controls">
                    <div class="run-params">
                        <div class="input-group">
                            <label>Benchmark iterations</label>
                            <input type="number" id="iterations" value="5" min="1">
                        </div>
                        <div class="input-group">
                            <label>Warmup runs (per test)</label>
                            <input type="number" id="warmup" value="1" min="0" max="50">
                        </div>
                    </div>
                    <div class="run-mode" id="run-mode">
                        <label class="run-mode-option">
                            <input type="radio" name="run-mode" value="standard" checked onchange="onRunModeChange()">
                            Standard Run (GitHub Actions)
                        </label>
                        <label class="run-mode-option">
                            <input type="radio" name="run-mode" value="local" onchange="onRunModeChange()">
                            Run Locally (WebAssembly)
                        </label>
                    </div>
                    <button class="btn btn-primary" id="run-btn" onclick="runAlgorithm()" disabled>
                        Run Algorithm
                    </button>
                    <button class="btn btn-danger" id="abort-btn" onclick="abortRun()" disabled>
                        Abort Run
                    </button>
                    <button class="btn" onclick="clearOutput()">Clear Output</button>
                </div>

                <div class="progress-area" id="progress-area" hidden>
                    <div class="run-timer" id="run-timer" hidden>Elapsed: 00:00</div>
                    <div class="progress-wrapper" id="progress-wrapper">
                        <div class="progress-meta">
                            <div class="progress-phase" id="progress-phase">Preparing...</div>
                            <div class="progress-count" id="progress-count">0/0</div>
                        </div>
                        <div class="progress-bar" id="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3 style="margin-bottom: 10px;">Output:</h3>
                    <div class="output-content" id="output">
No output yet. Select an algorithm and input files, then click "Run Algorithm".
                    </div>
                </div>
                <div class="charts" id="charts" hidden>
                    <div class="chart-panel">
                        <div class="chart-title">Runtime (ms)</div>
                        <div class="chart"><canvas id="runtime-chart"></canvas></div>
                    </div>
                    <div class="chart-panel">
                        <div class="chart-title">Memory (kB)</div>
                        <div class="chart"><canvas id="memory-chart"></canvas></div>
                    </div>
                </div>
                <div class="graph-panel graph-panel-small" id="pattern-panel" hidden>
                    <div class="chart-title">Pattern Visualization</div>
                    <div class="graph-actions">
                        <button class="btn btn-secondary btn-center-graph" id="pattern-center-btn" onclick="centerPatternGraph()" type="button">Center</button>
                    </div>
                    <div class="graph-note" id="pattern-note"></div>
                    <div class="graph-canvas graph-canvas-small" id="pattern-canvas"></div>
                </div>
                <div class="graph-panel" id="graph-panel" hidden>
                    <div class="chart-title">Graph Visualization</div>
                    <div class="graph-actions">
                        <button class="btn btn-secondary btn-center-graph" id="graph-center-btn" onclick="centerMainGraph()" type="button">Center</button>
                        <div class="iteration-controls" id="iteration-controls">
                            <button class="btn btn-secondary btn-solution-nav" id="iteration-prev-btn" onclick="showPreviousIteration()" type="button">◀</button>
                            <span class="solution-label" id="iteration-label">Iteration 1</span>
                            <button class="btn btn-secondary btn-solution-nav" id="iteration-next-btn" onclick="showNextIteration()" type="button">▶</button>
                        </div>
                        <div class="solution-controls" id="solution-controls">
                            <button class="btn btn-secondary btn-solution-nav" id="solution-prev-btn" onclick="showPreviousSolution()" type="button">◀</button>
                            <span class="solution-label" id="solution-label">Solution 0</span>
                            <button class="btn btn-secondary btn-solution-nav" id="solution-next-btn" onclick="showNextSolution()" type="button">▶</button>
                        </div>
                        <span class="solution-warning" id="solution-warning" hidden>No solutions found</span>
                    </div>
                    <div class="graph-note" id="graph-note"></div>
                    <div class="graph-canvas" id="graph-canvas"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Split frontend runtime (load in order; globals are shared across scripts) -->
    <script src="js/app/01-state-progress-checks.js"></script>
    <script src="js/app/02-inputs-generator-ui.js"></script>
    <script src="js/app/03-generator-estimation.js"></script>
    <script src="js/app/04-local-wasm-and-local-runner.js"></script>
    <script src="js/app/05-github-workflow-runner.js"></script>
    <script src="js/app/06-results-and-charts.js"></script>
    <script src="js/app/07-visualization-api-bootstrap.js"></script>
</body>
</html>
